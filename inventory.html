<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory</title>
  <link rel="stylesheet" href="style.css">
  <style>
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #aaa; padding: 6px; text-align: center; }
    th { background-color: #f0f0f0; }
    input[type="number"] { width: 60px; }
    input[type="text"] { width: 100%; }
    .category-row { background-color: #ddd; font-weight: bold; text-align: left; }
    .menu { background-color: #222; color: #fff; padding: 10px; }
    .menu a { color: #fff; margin-right: 10px; text-decoration: none; }
  </style>
</head>
<body>

<div class="menu">
  <a href="index.html">Home</a>
  <a href="inventory.html">Inventory</a>
  <a href="orders.html">Orders</a>
</div>

<h1>Inventory Management</h1>

<!-- Product Form -->
<form id="addProductForm" style="max-width: 400px; margin-bottom: 20px;">
  <div>
    <label>Product Name (required):<br/>
      <input type="text" id="productName" required />
    </label>
  </div>

  <div>
    <label>Category (required):<br/>
      <input type="text" id="productCategory" required />
    </label>
  </div>

  <div>
    <label>Price ($) (required):<br/>
      <input type="number" id="productPrice" step="0.01" required />
    </label>
  </div>

  <div>
    <label>
      <input type="checkbox" id="productHasSizes" />
      Has Sizes?
    </label>
  </div>

  <div>
    Gender:<br/>
    <label><input type="checkbox" id="productGenderMale" /> M</label>
    <label><input type="checkbox" id="productGenderFemale" /> F</label>
  </div>

  <div>
    <label>Product Image:<br/>
      <input type="file" id="productImage" accept="image/*" />
    </label>
  </div>

  <button type="submit" style="margin-top: 10px;">Add Product</button>
</form>

<!-- Inventory Table -->
<div id="inventoryList"></div>

<!-- Edit Discounts Placeholder -->
<section id="editDiscounts">
  <h2>Edit Discounts</h2>
  <p>Feature coming soon...</p>
</section>

<script>
  const form = document.getElementById('addProductForm');
  const inventoryList = document.getElementById('inventoryList');
  let inventoryData = JSON.parse(localStorage.getItem('inventoryData')) || [];

  const sizes = ["S", "M", "L", "XL", "2XL"];

  function renderInventory() {
    const grouped = {};

    inventoryData.forEach(product => {
      if (!grouped[product.category]) grouped[product.category] = [];
      grouped[product.category].push(product);
    });

    let html = "<table><tbody>";

    for (const category in grouped) {
      html += `<tr class="category-row"><td colspan="${productHasSizes(grouped[category]) ? 9 : 5}">${category}</td></tr>`;
      html += `
        <tr>
          <th>Name</th>
          <th>Gender</th>
          ${grouped[category][0].hasSizes ? sizes.map(s => `<th>${s}</th>`).join('') : '<th>Qty</th>'}
          <th>Price</th>
          <th>Delete</th>
        </tr>`;

      grouped[category].forEach((product, index) => {
        html += `<tr>
          <td>${product.name}</td>
          <td contenteditable="true">${product.gender}</td>`;

        if (product.hasSizes) {
          sizes.forEach(size => {
            html += `<td><input type="number" value="${product.sizes[size] || 0}" /></td>`;
          });
        } else {
          html += `<td><input type="number" value="${product.quantity}" /></td>`;
        }

        html += `
          <td>$${product.price.toFixed(2)}</td>
          <td><button onclick="deleteProduct(${product.id})">Delete</button></td>
        </tr>`;
      });
    }

    html += "</tbody></table>";
    inventoryList.innerHTML = html;
  }

  function productHasSizes(products) {
    return products.some(p => p.hasSizes);
  }

  function deleteProduct(id) {
    inventoryData = inventoryData.filter(p => p.id !== id);
    localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
    renderInventory();
  }

  form.addEventListener('submit', e => {
    e.preventDefault();

    const name = document.getElementById('productName').value.trim();
    const category = document.getElementById('productCategory').value.trim();
    const price = parseFloat(document.getElementById('productPrice').value);
    const hasSizes = document.getElementById('productHasSizes').checked;
    const gender = [
      document.getElementById('productGenderMale').checked ? 'M' : '',
      document.getElementById('productGenderFemale').checked ? 'F' : ''
    ].filter(Boolean).join('/');

    if (!name || !category || isNaN(price)) return;

    const newProduct = {
      id: Date.now(),
      name,
      category,
      price,
      gender,
      hasSizes,
      quantity: hasSizes ? undefined : 0,
      sizes: hasSizes ? Object.fromEntries(sizes.map(s => [s, 0])) : undefined
    };

    inventoryData.push(newProduct);
    localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
    form.reset();
    renderInventory();
  });

  window.onload = renderInventory;
</script>
</body>
</html>