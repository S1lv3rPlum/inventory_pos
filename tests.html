<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Inventory App</title>
  <style>
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    .category-header, .discount-type-header {
      background-color: #ddd;
      font-weight: bold;
      text-align: left;
    }
    .action-buttons button { margin: 0 2px; }
  </style>
</head>
<body>
  <h2>Product Inventory</h2>
  <input type="file" id="importFile" accept=".xlsx">
  <button onclick="exportToExcel()">Export</button>
  <button onclick="addProduct()">Add Product</button>  <table id="productTable">
    <thead>
      <tr>
        <th>Product</th>
        <th>Cost</th>
        <th>XS</th>
        <th>S</th>
        <th>M</th>
        <th>L</th>
        <th>XL</th>
        <th>2XL</th>
        <th>3XL</th>
        <th>4XL</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="productTableBody"></tbody>
  </table>  <h2>Discounts</h2>
  <table id="discountTable">
    <thead>
      <tr>
        <th>Code</th>
        <th>Amount</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="discountTableBody"></tbody>
  </table>  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>  <script>
    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
    let discounts = JSON.parse(localStorage.getItem('discounts')) || [];

    function saveToStorage() {
      localStorage.setItem('inventory', JSON.stringify(inventory));
      localStorage.setItem('discounts', JSON.stringify(discounts));
    }

    function renderTables() {
      const productBody = document.getElementById('productTableBody');
      const discountBody = document.getElementById('discountTableBody');
      productBody.innerHTML = '';
      discountBody.innerHTML = '';

      const grouped = inventory.reduce((acc, item) => {
        if (!acc[item.category]) acc[item.category] = [];
        acc[item.category].push(item);
        return acc;
      }, {});

      Object.keys(grouped).sort().forEach(category => {
        const headerRow = document.createElement('tr');
        const headerCell = document.createElement('td');
        headerCell.colSpan = 11;
        headerCell.className = 'category-header';
        headerCell.textContent = category;
        headerRow.appendChild(headerCell);
        productBody.appendChild(headerRow);

        grouped[category].sort((a, b) => a.name.localeCompare(b.name)).forEach(item => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><input value="${item.name}" onchange="updateField('${item.id}', 'name', this.value)"></td>
            <td><input value="${item.cost}" onchange="updateField('${item.id}', 'cost', this.value)"></td>
            ${['XS','S','M','L','XL','2XL','3XL','4XL'].map(size => `<td><input value="${item.sizes[size] || ''}" onchange="updateSize('${item.id}', '${size}', this.value)"></td>`).join('')}
            <td class="action-buttons">
              <button onclick="deleteProduct('${item.id}')">Delete</button>
            </td>`;
          productBody.appendChild(row);
        });
      });

      const groupedDiscounts = discounts.reduce((acc, item) => {
        if (!acc[item.type]) acc[item.type] = [];
        acc[item.type].push(item);
        return acc;
      }, {});

      Object.keys(groupedDiscounts).sort().forEach(type => {
        const headerRow = document.createElement('tr');
        const headerCell = document.createElement('td');
        headerCell.colSpan = 3;
        headerCell.className = 'discount-type-header';
        headerCell.textContent = type;
        headerRow.appendChild(headerCell);
        discountBody.appendChild(headerRow);

        groupedDiscounts[type].forEach(item => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><input value="${item.code}" onchange="updateDiscount('${item.id}', 'code', this.value)"></td>
            <td><input value="${item.amount}" onchange="updateDiscount('${item.id}', 'amount', this.value)"></td>
            <td><button onclick="deleteDiscount('${item.id}')">Delete</button></td>`;
          discountBody.appendChild(row);
        });
      });
    }

    function addProduct() {
      const newItem = {
        id: crypto.randomUUID(),
        name: 'New Product',
        category: 'Uncategorized',
        cost: '',
        sizes: {}
      };
      inventory.push(newItem);
      saveToStorage();
      renderTables();
    }

    function updateField(id, field, value) {
      const item = inventory.find(p => p.id === id);
      if (item) {
        item[field] = value;
        saveToStorage();
      }
    }

    function updateSize(id, size, value) {
      const item = inventory.find(p => p.id === id);
      if (item) {
        item.sizes[size] = value;
        saveToStorage();
      }
    }

    function deleteProduct(id) {
      inventory = inventory.filter(p => p.id !== id);
      saveToStorage();
      renderTables();
    }

    function updateDiscount(id, field, value) {
      const item = discounts.find(d => d.id === id);
      if (item) {
        item[field] = value;
        saveToStorage();
      }
    }

    function deleteDiscount(id) {
      discounts = discounts.filter(d => d.id !== id);
      saveToStorage();
      renderTables();
    }

    document.getElementById('importFile').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      const data = await file.arrayBuffer();
      const wb = XLSX.read(data);
      const prodSheet = wb.Sheets['Products'];
      const discSheet = wb.Sheets['Discounts'];
      if (prodSheet) {
        const rows = XLSX.utils.sheet_to_json(prodSheet);
        rows.forEach(row => {
          const existing = inventory.find(i => i.id === row.id);
          if (existing) Object.assign(existing, row);
          else inventory.push(row);
        });
      }
      if (discSheet) {
        const rows = XLSX.utils.sheet_to_json(discSheet);
        rows.forEach(row => {
          const existing = discounts.find(d => d.id === row.id);
          if (existing) Object.assign(existing, row);
          else discounts.push(row);
        });
      }
      saveToStorage();
      renderTables();
    });

    function exportToExcel() {
      const prodSheet = XLSX.utils.json_to_sheet(inventory);
      const discSheet = XLSX.utils.json_to_sheet(discounts);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, prodSheet, 'Products');
      XLSX.utils.book_append_sheet(wb, discSheet, 'Discounts');
      XLSX.writeFile(wb, 'inventory.xlsx');
    }

    renderTables();
  </script></body>
</html>