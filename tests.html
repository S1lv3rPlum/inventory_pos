<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Test Inventory Page</title>
  <style>
    body { font-family: Arial, sans-serif; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    img { width: 50px; height: auto; }
  </style>
</head>
<body>
  <h1>Inventory Manager3</h1>

  <form id="productForm">
    <label>Category: <input type="text" id="productCategory" required></label><br>
    <label>Product Name: <input type="text" id="productName" required></label><br>
    <label>Image URL: <input type="text" id="productImage"></label><br>
    <label><input type="checkbox" id="hasSizes"> Has Sizes (S-2XL)</label><br>
    <div id="sizeQuantities" style="display:none;">
      <label>S: <input type="number" name="sizeQty" data-size="S" min="0" value="0"></label>
      <label>M: <input type="number" name="sizeQty" data-size="M" min="0" value="0"></label>
      <label>L: <input type="number" name="sizeQty" data-size="L" min="0" value="0"></label>
      <label>XL: <input type="number" name="sizeQty" data-size="XL" min="0" value="0"></label>
      <label>2XL: <input type="number" name="sizeQty" data-size="2XL" min="0" value="0"></label>
    </div>
    <button type="submit">Add Product</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Category</th>
        <th>Product Name</th>
        <th>Image</th>
        <th>Size</th>
        <th>Quantity</th>
      </tr>
    </thead>
    <tbody id="inventoryTableBody"></tbody>
  </table>

  <script>
    const sizeCheckbox = document.getElementById('hasSizes');
    const sizeInputsDiv = document.getElementById('sizeQuantities');

    sizeCheckbox.addEventListener('change', () => {
      sizeInputsDiv.style.display = sizeCheckbox.checked ? 'block' : 'none';
    });

    document.getElementById('productForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const category = document.getElementById('productCategory').value;
      const name = document.getElementById('productName').value;
      const image = document.getElementById('productImage').value;
      const hasSizes = document.getElementById('hasSizes').checked;

      const products = JSON.parse(localStorage.getItem('products')) || {};
      if (!products[category]) products[category] = {};

      const productEntry = { image: image, sizes: {} };

      if (hasSizes) {
        const sizeInputs = document.querySelectorAll('input[name="sizeQty"]');
        sizeInputs.forEach(input => {
          const size = input.getAttribute('data-size');
          const qty = parseInt(input.value);
          if (qty > 0) productEntry.sizes[size] = qty;
        });
      } else {
        productEntry.sizes['OneSize'] = 1; // fallback
      }

      products[category][name] = productEntry;
      localStorage.setItem('products', JSON.stringify(products));
      this.reset();
      sizeInputsDiv.style.display = 'none';
      loadInventory();
    });

    function loadInventory() {
      const inventory = JSON.parse(localStorage.getItem('products')) || {};
      const tableBody = document.getElementById('inventoryTableBody');
      tableBody.innerHTML = '';

      for (const category in inventory) {
        const products = inventory[category];

        for (const productName in products) {
          const product = products[productName];
          const sizes = product.sizes || {};
          const imageURL = product.image || '';
          const sizeKeys = Object.keys(sizes);
          const rowCount = sizeKeys.length;

          sizeKeys.forEach((size, index) => {
            const row = document.createElement('tr');

            if (index === 0) {
              const categoryCell = document.createElement('td');
              categoryCell.rowSpan = rowCount;
              categoryCell.textContent = category;
              row.appendChild(categoryCell);

              const nameCell = document.createElement('td');
              nameCell.rowSpan = rowCount;
              nameCell.textContent = productName;
              row.appendChild(nameCell);

              const imgCell = document.createElement('td');
              imgCell.rowSpan = rowCount;
              imgCell.innerHTML = imageURL ? `<img src="${imageURL}" alt="${productName}">` : 'No Image';
              row.appendChild(imgCell);
            }

            const sizeCell = document.createElement('td');
            sizeCell.textContent = size;
            row.appendChild(sizeCell);

            const qtyCell = document.createElement('td');
            qtyCell.textContent = sizes[size];
            row.appendChild(qtyCell);

            tableBody.appendChild(row);
          });
        }
      }
    }

    window.addEventListener('DOMContentLoaded', loadInventory);
  </script>
</body>
</html>