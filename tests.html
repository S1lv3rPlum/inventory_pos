<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Inventory</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .category-header {
      background-color: #ddd;
      font-weight: bold;
    }
    .edit-btn, .delete-btn, .save-btn, .cancel-btn {
      margin-right: 5px;
    }
    .gender-toggle {
      display: flex;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h1>Inventory Manager</h1>

<div style="display: flex; gap: 10px; margin-bottom: 1rem;">
  <button type="button" id="exportInventoryBtn">⬆️ Export Inventory</button>
  <button type="button" id="importInventoryBtn">⬇️ Import Inventory</button>
  <input type="file" id="importInventoryFile" accept=".csv" style="display:none" />
</div>

  <h2>Add Product2</h2>
  <form id="productForm">
    <div
    <label>Category:
      <input type="text" id="category" required />
    </label>
    </div>
    <div></div>
    <label>Product Name:
      <input type="text" id="productName" required />
    </label>
    </div>
    <fieldset>
      <legend>Gender:</legend>
      <label><input type="checkbox" name="gender" value="M" /> M</label>
      <label><input type="checkbox" name="gender" value="F" /> F</label>
    </fieldset>
    <button type="submit">Add Product</button>
  </form>

  <table id="inventoryTable">
    <thead>
      <tr>
        <th>Product Name</th>
        <th>Gender</th>
        <th>Size XS</th>
        <th>Size S</th>
        <th>Size M</th>
        <th>Size L</th>
        <th>Size XL</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  const exportBtn = document.getElementById('exportInventoryBtn');
const importBtn = document.getElementById('importInventoryBtn');
const importFileInput = document.getElementById('importInventoryFile');

// Export inventory as CSV
exportBtn.addEventListener('click', () => {
  const rows = [['Category','Product Name','Gender','Size XS','Size S','Size M','Size L','Size XL']];
  
  Object.keys(inventory).forEach(category => {
    inventory[category].forEach(product => {
      rows.push([
        category,
        product.productName,
        product.gender,
        product.sizes.XS ?? 0,
        product.sizes.S ?? 0,
        product.sizes.M ?? 0,
        product.sizes.L ?? 0,
        product.sizes.XL ?? 0,
      ]);
    });
  });

  const csvContent = rows.map(e => e.join(',')).join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);

  const a = document.createElement('a');
  a.href = url;
  a.download = 'inventory.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

// Import inventory from CSV
importBtn.addEventListener('click', () => {
  importFileInput.click();
});

importFileInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    const text = evt.target.result;
    parseCSVAndLoadInventory(text);
    importFileInput.value = ''; // reset input
  };
  reader.readAsText(file);
});

function parseCSVAndLoadInventory(csvText) {
  const lines = csvText.trim().split('\n');
  if (lines.length < 2) {
    alert('CSV file appears empty or invalid.');
    return;
  }
  
  // Clear current inventory
  inventory = {};
  
  // Skip header line (assumed first line)
  for (let i = 1; i < lines.length; i++) {
    const cols = lines[i].split(',');
    if (cols.length < 8) continue; // not enough columns

    const [category, productName, gender, XS, S, M, L, XL] = cols;
    if (!category || !productName) continue;

    if (!inventory[category]) inventory[category] = [];
    
    inventory[category].push({
      productName: productName.trim(),
      gender: gender.trim(),
      sizes: {
        XS: parseInt(XS) || 0,
        S: parseInt(S) || 0,
        M: parseInt(M) || 0,
        L: parseInt(L) || 0,
        XL: parseInt(XL) || 0
      }
    });
  }
  
  saveToLocalStorage();
  renderTable();
  alert('Inventory imported successfully!');
}
  
    const form = document.getElementById('productForm');
    const tableBody = document.querySelector('#inventoryTable tbody');
    let inventory = {};

    form.addEventListener('submit', e => {
      e.preventDefault();
      const category = document.getElementById('category').value.trim();
      const productName = document.getElementById('productName').value.trim();
      const gender = Array.from(document.querySelectorAll('input[name="gender"]:checked')).map(cb => cb.value).join('/');
      if (!productName || !category) return;

      if (!inventory[category]) inventory[category] = [];
      inventory[category].push({ productName, gender, sizes: { XS: 0, S: 0, M: 0, L: 0, XL: 0 } });
      form.reset();
      saveToLocalStorage();
      renderTable();
    });

    function renderTable() {
      tableBody.innerHTML = '';
      Object.keys(inventory).sort().forEach(category => {
        const headerRow = document.createElement('tr');
        const headerCell = document.createElement('td');
        headerCell.colSpan = 8;
        headerCell.className = 'category-header';
        headerCell.textContent = category;
        headerRow.appendChild(headerCell);
        tableBody.appendChild(headerRow);

        inventory[category].sort((a, b) => a.productName.localeCompare(b.productName)).forEach(product => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="prod-name">${product.productName}</td>
            <td class="gender-toggle">${formatGender(product.gender)}</td>
            ${['XS', 'S', 'M', 'L', 'XL'].map(size => `<td class="size" data-size="${size}">${product.sizes[size]}</td>`).join('')}
            <td>
              <button class="edit-btn">Edit</button>
              <button class="delete-btn">Delete</button>
            </td>
          `;
          tableBody.appendChild(row);

          row.querySelector('.edit-btn').addEventListener('click', () => toggleEdit(row, product, category));
          row.querySelector('.delete-btn').addEventListener('click', () => {
            inventory[category] = inventory[category].filter(p => p !== product);
            if (inventory[category].length === 0) delete inventory[category];
            saveToLocalStorage();
            renderTable();
          });
        });
      });
    }

    function formatGender(genderStr) {
      const genders = ['M', 'F'];
      return genders.map(g => `<label><input type="checkbox" value="${g}" ${genderStr.includes(g) ? 'checked' : ''} disabled /> ${g}</label>`).join('');
    }

    function toggleEdit(row, product, category) {
      const isEditing = row.classList.toggle('editing');
      if (isEditing) {
        const prodNameCell = row.querySelector('.prod-name');
        prodNameCell.innerHTML = `<input type="text" value="${product.productName}" />`;

        const genderCell = row.querySelector('.gender-toggle');
        genderCell.innerHTML = ['M', 'F'].map(g => `<label><input type="checkbox" value="${g}" ${product.gender.includes(g) ? 'checked' : ''} /> ${g}</label>`).join('');

        row.querySelectorAll('.size').forEach(td => {
          const size = td.dataset.size;
          td.innerHTML = `<input type="number" class="size-input" min="0" value="${product.sizes[size]}" />`;
        });

        const actionCell = row.querySelector('td:last-child');
        actionCell.innerHTML = '<button class="save-btn">Save</button><button class="cancel-btn">Cancel</button>';

        actionCell.querySelector('.save-btn').addEventListener('click', () => {
          product.productName = prodNameCell.querySelector('input').value.trim();
          const genderChecks = genderCell.querySelectorAll('input[type="checkbox"]');
          const selectedGenders = Array.from(genderChecks).filter(cb => cb.checked).map(cb => cb.value);
          product.gender = selectedGenders.join('/');
          row.querySelectorAll('.size').forEach(td => {
            const size = td.dataset.size;
            product.sizes[size] = parseInt(td.querySelector('input').value || '0');
          });
          saveToLocalStorage();
          renderTable();
        });

        actionCell.querySelector('.cancel-btn').addEventListener('click', renderTable);
      }
    }

    function saveToLocalStorage() {
      localStorage.setItem('inventoryData', JSON.stringify(inventory));
    }

    function loadFromLocalStorage() {
      const data = localStorage.getItem('inventoryData');
      if (data) {
        inventory = JSON.parse(data);
        renderTable();
      }
    }

    window.addEventListener('DOMContentLoaded', loadFromLocalStorage);
  </script>
</body>
</html>