<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Inventory Manager</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    input[type="number"] {
      width: 4ch;
    }
    .category-header {
      font-weight: bold;
      background-color: #f0f0f0;
    }
    .btn {
      margin: 4px;
    }
  </style>
</head>
<body>
  <h1>Inventory Manager</h1>

  <button class="btn" onclick="exportInventory()">Export Inventory</button>
  <button class="btn" onclick="document.getElementById('importInventoryFile').click()">Import Inventory</button>
  <input type="file" id="importInventoryFile" accept=".csv" style="display: none;" onchange="importInventory()" />

  <h2>Add Product</h2>
  <form id="productForm">
    <label>Category: <input type="text" id="category" required /></label><br />
    <label>Product Name: <input type="text" id="productName" required /></label><br />
    <fieldset>
      <legend>Gender:</legend>
      <label><input type="checkbox" name="gender" value="Men" /> Men</label>
      <label><input type="checkbox" name="gender" value="Women" /> Women</label>
      <label><input type="checkbox" name="gender" value="Unisex" /> Unisex</label>
    </fieldset>
    <button type="submit">Add Product</button>
  </form>

  <h2>Product Inventory</h2>
  <table id="inventoryTable">
    <thead>
      <tr>
        <th>Product Name</th>
        <th>Gender</th>
        <th>XS</th><th>S</th><th>M</th><th>L</th><th>XL</th>
        <th>2XL</th><th>3XL</th><th>4XL</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const sizes = ["XS", "S", "M", "L", "XL", "2XL", "3XL", "4XL"];

    document.getElementById("productForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const category = document.getElementById("category").value.trim();
      const productName = document.getElementById("productName").value.trim();
      const gender = [...document.querySelectorAll('input[name="gender"]:checked')].map(cb => cb.value).join(", ");

      if (!category || !productName || !gender) {
        alert("Please fill out all fields.");
        return;
      }

      let tbody = document.querySelector("#inventoryTable tbody");
      let lastCategoryRow = [...tbody.querySelectorAll("tr.category-header")].pop();
      if (!lastCategoryRow || lastCategoryRow.dataset.category !== category) {
        const catRow = document.createElement("tr");
        catRow.className = "category-header";
        catRow.dataset.category = category;
        const td = document.createElement("td");
        td.colSpan = sizes.length + 3;
        td.textContent = category;
        catRow.appendChild(td);
        tbody.appendChild(catRow);
      }

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${productName}</td>
        <td>${gender}</td>
        ${sizes.map(() => `<td><input type="number" min="0" value="0" /></td>`).join("")}
        <td>
          <button onclick="editRow(this)">Edit</button>
          <button onclick="saveRow(this)" disabled>Save</button>
          <button onclick="deleteRow(this)">Delete</button>
        </td>
      `;
      tbody.appendChild(row);

      this.reset();
    });

    function editRow(btn) {
      const row = btn.closest("tr");
      row.querySelectorAll("input[type='number']").forEach(input => input.removeAttribute("disabled"));
      row.querySelector("button[onclick='editRow(this)']").disabled = true;
      row.querySelector("button[onclick='saveRow(this)']").disabled = false;
    }

    function saveRow(btn) {
      const row = btn.closest("tr");
      row.querySelectorAll("input[type='number']").forEach(input => input.setAttribute("disabled", true));
      row.querySelector("button[onclick='editRow(this)']").disabled = false;
      row.querySelector("button[onclick='saveRow(this)']").disabled = true;
    }

    function deleteRow(btn) {
      const row = btn.closest("tr");
      const tbody = row.parentElement;
      const prev = row.previousElementSibling;
      row.remove();
      if (prev && prev.classList.contains("category-header")) {
        const next = prev.nextElementSibling;
        if (!next || next.classList.contains("category-header")) {
          prev.remove();
        }
      }
    }

    function exportInventory() {
      const rows = document.querySelectorAll("#inventoryTable tr");
      let csv = [["Category", "Product Name", "Gender", ...sizes, ""]];
      let currentCategory = "";

      rows.forEach(row => {
        if (row.classList.contains("category-header")) {
          currentCategory = row.textContent.trim();
        } else if (!row.querySelector("th")) {
          const cols = row.querySelectorAll("td");
          const productName = cols[0].textContent.trim();
          const gender = cols[1].textContent.trim();
          const qtys = sizes.map((_, i) => cols[i + 2].querySelector("input").value || "0");
          csv.push([currentCategory, productName, gender, ...qtys, ""]);
        }
      });

      const blob = new Blob([csv.map(e => e.join(",")).join("\n")], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "inventory.csv";
      a.click();
    }

    function importInventory() {
      const fileInput = document.getElementById("importInventoryFile");
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const lines = e.target.result.split("\n").filter(line => line.trim());
        const [header, ...dataRows] = lines;
        const tbody = document.querySelector("#inventoryTable tbody");
        tbody.innerHTML = "";

        let currentCategory = "";

        dataRows.forEach(line => {
          const cols = line.split(",");
          const [category, productName, gender, ...qtys] = cols;

          if (currentCategory !== category) {
            currentCategory = category;
            const catRow = document.createElement("tr");
            catRow.className = "category-header";
            catRow.dataset.category = category;
            const td = document.createElement("td");
            td.colSpan = sizes.length + 3;
            td.textContent = category;
            catRow.appendChild(td);
            tbody.appendChild(catRow);
          }

          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${productName}</td>
            <td>${gender}</td>
            ${sizes.map((_, i) => `<td><input type="number" value="${qtys[i] || 0}" disabled /></td>`).join("")}
            <td>
              <button onclick="editRow(this)">Edit</button>
              <button onclick="saveRow(this)" disabled>Save</button>
              <button onclick="deleteRow(this)">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      };

      reader.readAsText(file);
      fileInput.value = ""; // reset for next upload
    }
  </script>
</body>
</html>