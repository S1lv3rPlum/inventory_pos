<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Inventory</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      padding: 5px;
    }
    .qty-input {
      width: 4ch;
    }
    .category-header {
      background-color: #ddd;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>Add Product</h2>
<form id="productForm">
  <div>
    <label>Category:
      <input type="text" id="category" required />
    </label>
  </div>

  <div>
    <label>Product Name:
      <input type="text" id="productName" required />
    </label>
  </div>

  <fieldset>
    <legend>Gender:</legend>
    <label><input type="radio" name="gender" value="Men" required /> Men</label>
    <label><input type="radio" name="gender" value="Women" /> Women</label>
    <label><input type="radio" name="gender" value="Unisex" /> Unisex</label>
  </fieldset>

  <button type="submit">Add Product</button>
</form>

<br>

<button id="exportBtn">Export CSV</button>
<input type="file" id="importInventoryFile" accept=".csv" style="display: none;" />
<button id="importBtn">Import CSV</button>

<br><br>

<table id="inventoryTable">
  <thead>
    <tr>
      <th>Product Name</th>
      <th>Gender</th>
      <th>XS</th>
      <th>S</th>
      <th>M</th>
      <th>L</th>
      <th>XL</th>
      <th>2XL</th>
      <th>3XL</th>
      <th>4XL</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const form = document.getElementById('productForm');
const tableBody = document.getElementById('inventoryTable').getElementsByTagName('tbody')[0];
const importBtn = document.getElementById('importBtn');
const importFileInput = document.getElementById('importInventoryFile');
const exportBtn = document.getElementById('exportBtn');

const sizeLabels = ["XS", "S", "M", "L", "XL", "2XL", "3XL", "4XL"];

form.addEventListener('submit', function (e) {
  e.preventDefault();
  const category = document.getElementById('category').value.trim();
  const productName = document.getElementById('productName').value.trim();
  const gender = document.querySelector('input[name="gender"]:checked').value;

  addProductRow(category, productName, gender);
  form.reset();
});

function addProductRow(category, productName, gender) {
  let categoryHeader = Array.from(tableBody.rows).find(row =>
    row.classList.contains('category-header') &&
    row.cells[0].textContent === category
  );

  if (!categoryHeader) {
    const newHeader = tableBody.insertRow();
    newHeader.classList.add('category-header');
    const cell = newHeader.insertCell(0);
    cell.colSpan = 11;
    cell.textContent = category;
  }

  const row = tableBody.insertRow();
  row.innerHTML = `
    <td contenteditable="true">${productName}</td>
    <td>
      <select>
        <option value="Men" ${gender === 'Men' ? 'selected' : ''}>Men</option>
        <option value="Women" ${gender === 'Women' ? 'selected' : ''}>Women</option>
        <option value="Unisex" ${gender === 'Unisex' ? 'selected' : ''}>Unisex</option>
      </select>
    </td>
    ${sizeLabels.map(() => `<td><input class="qty-input" type="number" min="0" value="0" /></td>`).join('')}
    <td>
      <button onclick="saveRow(this)">Save</button>
      <button onclick="deleteRow(this)">Delete</button>
    </td>
  `;
}

function saveRow(button) {
  const row = button.closest('tr');
  // You could add logic here to save to local storage or backend
  alert('Saved!');
}

function deleteRow(button) {
  const row = button.closest('tr');
  const categoryRow = row.previousElementSibling;
  row.remove();

  // Remove category header if no other rows remain
  if (categoryRow && categoryRow.classList.contains('category-header')) {
    const nextRow = categoryRow.nextElementSibling;
    if (!nextRow || nextRow.classList.contains('category-header')) {
      categoryRow.remove();
    }
  }
}

exportBtn.addEventListener('click', () => {
  let csvContent = "Category,Product Name,Gender," + sizeLabels.join(",") + "\n";
  let currentCategory = "";

  for (const row of tableBody.rows) {
    if (row.classList.contains("category-header")) {
      currentCategory = row.cells[0].textContent;
      continue;
    }

    const productName = row.cells[0].textContent.trim();
    const gender = row.cells[1].querySelector("select").value;
    const qtys = Array.from(row.querySelectorAll("input")).map(input => input.value.trim());
    csvContent += `${currentCategory},${productName},${gender},${qtys.join(",")}\n`;
  }

  const blob = new Blob([csvContent], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "inventory.csv";
  a.click();
  URL.revokeObjectURL(url);
});

importBtn.addEventListener("click", () => {
  importFileInput.click();
});

importFileInput.addEventListener("change", (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const lines = e.target.result.split("\n").filter(Boolean);
    lines.shift(); // Remove header
    tableBody.innerHTML = "";

    for (const line of lines) {
      const [category, productName, gender, ...qtys] = line.split(",");

      let categoryHeader = Array.from(tableBody.rows).find(row =>
        row.classList.contains('category-header') &&
        row.cells[0].textContent === category
      );

      if (!categoryHeader) {
        const newHeader = tableBody.insertRow();
        newHeader.classList.add('category-header');
        const cell = newHeader.insertCell(0);
        cell.colSpan = 11;
        cell.textContent = category;
      }

      const row = tableBody.insertRow();
      row.innerHTML = `
        <td contenteditable="true">${productName}</td>
        <td>
          <select>
            <option value="Men" ${gender === 'Men' ? 'selected' : ''}>Men</option>
            <option value="Women" ${gender === 'Women' ? 'selected' : ''}>Women</option>
            <option value="Unisex" ${gender === 'Unisex' ? 'selected' : ''}>Unisex</option>
          </select>
        </td>
        ${qtys.map(q => `<td><input class="qty-input" type="number" min="0" value="${q.trim()}" /></td>`).join('')}
        <td>
          <button onclick="saveRow(this)">Save</button>
          <button onclick="deleteRow(this)">Delete</button>
        </td>
      `;
    }
  };
  reader.readAsText(file);
});
</script>

</body>
</html>