<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Inventory Manager</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
  h1 { text-align: center; }
  label { margin-right: 15px; display: inline-block; margin-bottom: 10px; }
  input, select { padding: 5px; font-size: 14px; }
  button { margin-top: 10px; padding: 8px 15px; cursor: pointer; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #aaa; padding: 8px; text-align: left; }
</style>
</head>
<body>

<h1>Inventory Manager</h1>

<form id="productForm">
  <label>Category: <input type="text" id="category" required /></label>
  <label>Product Name: <input type="text" id="productName" required /></label>
  <label>Price: <input type="number" id="price" step="0.01" min="0" required /></label>
  <label>
    Unisex:
    <select id="unisex" required>
      <option value="">-- Select --</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>
  </label>
  <label>
    Has Sizes:
    <select id="hasSizes" required>
      <option value="">-- Select --</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>
  </label>
  <br />
  <button type="submit">Add Product</button>
</form>

<table id="productTable" aria-label="Inventory product list">
  <thead>
    <tr>
      <th>Category</th>
      <th>Name</th>
      <th>Price</th>
      <th>Unisex</th>
      <th>Sizes</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const products = [];
  const sizeLabels = ["XS", "S", "M", "L", "XL", "2XL", "3XL", "4XL"];
  let editingIndex = null;

  document.getElementById("productForm").addEventListener("submit", e => {
    e.preventDefault();

    const category = document.getElementById("category").value.trim();
    const name = document.getElementById("productName").value.trim();
    const price = parseFloat(document.getElementById("price").value);
    const unisex = document.getElementById("unisex").value;
    const hasSizes = document.getElementById("hasSizes").value;

    if (!category || !name || isNaN(price) || !unisex || !hasSizes) {
      alert("Please fill in all required fields.");
      return;
    }

    const sizes = hasSizes === "Yes" ? sizeLabels.reduce((acc, size) => {
      acc[size] = 0;
      return acc;
    }, {}) : null;

    const newProduct = { category, name, price, unisex, sizes };

    if (editingIndex !== null) {
      products[editingIndex] = newProduct;
      editingIndex = null;
    } else {
      products.push(newProduct);
    }

    renderTable();
    document.getElementById("productForm").reset();
  });

  let currentlyEditingRow = null;

function renderTable() {
  const tableBody = document.getElementById("productTableBody");
  tableBody.innerHTML = "";

  const transaction = db.transaction(["products"], "readonly");
  const store = transaction.objectStore("products");
  const request = store.getAll();

  request.onsuccess = () => {
    const products = request.result;
    products.forEach((product) => {
      const row = document.createElement("tr");

      const nameCell = document.createElement("td");
      nameCell.textContent = product.name;

      const priceCell = document.createElement("td");
      priceCell.textContent = product.price.toFixed(2);

      const quantityCell = document.createElement("td");
      quantityCell.textContent = product.quantity;

      const actionsCell = document.createElement("td");

     const editButton = document.createElement("button");
editButton.textContent = "Edit";
editButton.classList.add("edit-btn");

editButton.addEventListener("click", () => {
  const isEditing = editButton.textContent === "Save";

  if (!isEditing) {
    // Switching to edit mode
    editButton.textContent = "Save";
    editButton.classList.add("editing");

    // Make row cells editable
    for (let i = 0; i < row.cells.length - 2; i++) { // skip buttons
      const cell = row.cells[i];
      const input = document.createElement("input");
      input.value = cell.textContent;
      cell.textContent = "";
      cell.appendChild(input);
    }
  } else {
    // Switching out of edit mode (saving)
    editButton.textContent = "Edit";
    editButton.classList.remove("editing");

    // Save input values back to table cells
    for (let i = 0; i < row.cells.length - 2; i++) {
      const cell = row.cells[i];
      const input = cell.querySelector("input");
      if (input) {
        cell.textContent = input.value;
      }
    }

    // TODO: Update IndexedDB or storage here
  }
});

      deleteButton.addEventListener("click", () => {
        const tx = db.transaction(["products"], "readwrite");
        const store = tx.objectStore("products");
        store.delete(product.id);
        tx.oncomplete = renderTable;
      });

      actionsCell.appendChild(editButton);
      actionsCell.appendChild(deleteButton);

      row.appendChild(nameCell);
      row.appendChild(priceCell);
      row.appendChild(quantityCell);
      row.appendChild(actionsCell);
      tableBody.appendChild(row);
    });
  };
}

function makeRowEditable(row, product, editButton) {
  const [nameCell, priceCell, quantityCell] = row.children;

  nameCell.innerHTML = `<input type="text" value="${product.name}" class="w-full px-1 border rounded" />`;
  priceCell.innerHTML = `<input type="number" value="${product.price}" step="0.01" class="w-full px-1 border rounded" />`;
  quantityCell.innerHTML = `<input type="number" value="${product.quantity}" class="w-full px-1 border rounded" />`;

  editButton.textContent = "Save";
}

function saveRowEdit(row, productId, editButton) {
  const [nameCell, priceCell, quantityCell] = row.children;

  const updatedProduct = {
    id: productId,
    name: nameCell.querySelector("input").value.trim(),
    price: parseFloat(priceCell.querySelector("input").value),
    quantity: parseInt(quantityCell.querySelector("input").value),
  };

  const tx = db.transaction(["products"], "readwrite");
  const store = tx.objectStore("products");
  store.put(updatedProduct);

  tx.oncomplete = () => {
    renderTable();
  };
}

function cancelEdit(row) {
  const cancelTx = db.transaction(["products"], "readonly");
  const store = cancelTx.objectStore("products");
  const id = parseInt(row.children[3].querySelector("button").dataset.id); // You can also store the product in a row.dataset if preferred

  const getReq = store.get(id);
  getReq.onsuccess = () => {
    const product = getReq.result;
    renderTable(); // This resets everything including the edited row
  };
}



function editRow(index) {
  const prod = products[index];
  const tbody = document.querySelector("#productTable tbody");
  const tr = tbody.children[index];

  tr.innerHTML = `
    <td><input type="text" value="${prod.category}" /></td>
    <td><input type="text" value="${prod.name}" /></td>
    <td><input type="number" value="${prod.price}" step="0.01" min="0" /></td>
    <td>
      <select>
        <option value="Yes" ${prod.unisex === "Yes" ? "selected" : ""}>Yes</option>
        <option value="No" ${prod.unisex === "No" ? "selected" : ""}>No</option>
      </select>
    </td>
    <td>
      ${prod.sizes ? Object.keys(prod.sizes).join(", ") : "-"}
    </td>
    <td>
      <button onclick="saveRow(${index})">Save</button>
      <button onclick="renderTable()">Cancel</button>
    </td>
  `;
}

function saveRow(index) {
  const tbody = document.querySelector("#productTable tbody");
  const tr = tbody.children[index];
  const inputs = tr.querySelectorAll("input, select");

  const updatedCategory = inputs[0].value.trim();
  const updatedName = inputs[1].value.trim();
  const updatedPrice = parseFloat(inputs[2].value);
  const updatedUnisex = inputs[3].value;

  if (!updatedCategory || !updatedName || isNaN(updatedPrice) || !updatedUnisex) {
    alert("Please fill in all required fields.");
    return;
  }

  products[index].category = updatedCategory;
  products[index].name = updatedName;
  products[index].price = updatedPrice;
  products[index].unisex = updatedUnisex;

  // sizes remain unchanged for now

  renderTable();
}

function deleteRow(index) {
  if (confirm("Are you sure you want to delete this product?")) {
    products.splice(index, 1); // remove from array
    renderTable(); // refresh view
  }
}

  function deleteProduct(index) {
    if (confirm("Are you sure you want to delete this product?")) {
      products.splice(index, 1);
      renderTable();
    }
  }

  function editProduct(index) {
    const prod = products[index];
    document.getElementById("category").value = prod.category;
    document.getElementById("productName").value = prod.name;
    document.getElementById("price").value = prod.price;
    document.getElementById("unisex").value = prod.unisex;
    document.getElementById("hasSizes").value = prod.sizes ? "Yes" : "No";
    editingIndex = index;
  }
</script>

</body>
</html>