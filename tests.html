<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inventory Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h1 {
      text-align: center;
    }
    .button-group {
      margin-bottom: 15px;
      text-align: center;
    }
    button {
      margin: 0 8px 10px;
      padding: 8px 15px;
      cursor: pointer;
    }
    #importExportButtons {
      margin-bottom: 20px;
      text-align: center;
    }
    form label {
      margin-right: 15px;
      display: inline-block;
      margin-bottom: 10px;
    }
    input[type="text"], input[type="number"], select {
      padding: 5px;
      font-size: 14px;
    }
    #productForm {
      margin-bottom: 15px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 15px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px 10px;
      text-align: left;
      vertical-align: middle;
    }
    tr.category-header-row {
      background-color: #ddd;
      font-weight: bold;
      text-align: center;
      font-size: 1.1em;
    }
    td.sizes-cell input {
      width: 40px;
      font-size: 13px;
      padding: 3px;
      margin: 0 2px;
      text-align: center;
    }
    td.editable {
      cursor: text;
    }
    td.actions-cell button {
      margin-right: 6px;
    }
  </style>
</head>
<body>

  <h1>Inventory Manager</h1>

  <div class="button-group">
    <button disabled>Import</button>
    <button disabled>Export</button>
    <button disabled>Inventory</button>
    <button disabled>Discounts</button>
  </div>

  <form id="productForm">
    <label>
      Category: <input type="text" id="category" required />
    </label>
    <label>
      Product Name: <input type="text" id="productName" required />
    </label>
    <label>
      Price: <input type="number" id="price" step="0.01" min="0" required />
    </label>
    <label>
      Unisex:
      <select id="unisex" required>
        <option value="">-- Select --</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>
    </label>
    <label>
      Has Sizes:
      <select id="hasSizes" required>
        <option value="">-- Select --</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>
    </label>
    <button type="submit">Add Product</button>
  </form>

  <table id="productTable" aria-label="Inventory product list">
    <thead>
      <tr>
        <th>Product</th>
        <th>Price</th>
        <th>Unisex</th>
        <th>Sizes</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Product rows inserted here -->
    </tbody>
  </table>

  <script>
    // Global product array
    let products = [];

    // Size labels to display/edit
    const sizeLabels = ["XS", "S", "M", "L", "XL", "2XL", "3XL", "4XL"];

    // Load products from localStorage on page load
    window.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("products");
      if (saved) {
        products = JSON.parse(saved);
      }
      renderProductTable();
    });

    // Save to localStorage helper
    function saveProducts() {
      localStorage.setItem("products", JSON.stringify(products));
    }

    // FIXED: Add product form submit handler
    document.getElementById("productForm").addEventListener("submit", e => {
      e.preventDefault();

      const category = document.getElementById("category").value.trim();
      const name = document.getElementById("productName").value.trim();
      const price = parseFloat(document.getElementById("price").value);
      const unisex = document.getElementById("unisex").value;
      const hasSizes = document.getElementById("hasSizes").value;

      if (!category || !name || isNaN(price) || !unisex || !hasSizes) {
        alert("Please fill in all required fields.");
        return;
      }

      const sizes = hasSizes === "Yes" ? sizeLabels.reduce((acc, size) => {
        acc[size] = 0;
        return acc;
      }, {}) : null;

      products.push({ category, name, price, unisex, sizes });
      saveProducts();
      renderProductTable();

      e.target.reset();
    });

    // Render product table with category header rows
    function renderProductTable() {
      const tbody = document.querySelector("#productTable tbody");
      tbody.innerHTML = "";

      if (products.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 5;
        td.style.textAlign = "center";
        td.textContent = "No products added yet.";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      // Group products by category
      const grouped = products.reduce((acc, product, i) => {
        if (!acc[product.category]) acc[product.category] = [];
        acc[product.category].push({...product, index: i});
        return acc;
      }, {});

      // For each category group, add header row, then product rows
      for (const category of Object.keys(grouped).sort((a,b) => a.localeCompare(b))) {
        const headerRow = document.createElement("tr");
        headerRow.classList.add("category-header-row");
        const th = document.createElement("td");
        th.colSpan = 5;
        th.textContent = category;
        headerRow.appendChild(th);
        tbody.appendChild(headerRow);

        grouped[category].forEach(prod => {
          const tr = document.createElement("tr");

          // Editable product name cell
          const nameCell = document.createElement("td");
          nameCell.contentEditable = "true";
          nameCell.textContent = prod.name;
          nameCell.classList.add("editable");
          nameCell.dataset.index = prod.index;
          nameCell.dataset.field = "name";
          tr.appendChild(nameCell);

          // Editable price cell
          const priceCell = document.createElement("td");
          priceCell.contentEditable = "true";
          priceCell.textContent = prod.price.toFixed(2);
          priceCell.classList.add("editable");
          priceCell.dataset.index = prod.index;
          priceCell.dataset.field = "price";
          tr.appendChild(priceCell);

          // Editable unisex cell (select element)
          const unisexCell = document.createElement("td");
          const select = document.createElement("select");
          select.innerHTML = `<option value="Yes">Yes</option><option value="No">No</option>`;
          select.value = prod.unisex;
          select.dataset.index = prod.index;
          select.dataset.field = "unisex";
          select.addEventListener("change", onSelectChange);
          unisexCell.appendChild(select);
          tr.appendChild(unisexCell);

          // Sizes cell
          const sizesCell = document.createElement("td");
          sizesCell.classList.add("sizes-cell");
          if (prod.sizes) {
            sizeLabels.forEach(size => {
              const input = document.createElement("input");
              input.type = "number";
              input.min = 0;
              input.value = prod.sizes[size] || 0;
              input.dataset.index = prod.index;
              input.dataset.size = size;
              input.addEventListener("change", onSizeQtyChange);
              sizesCell.appendChild(input);
            });
          } else {
            sizesCell.textContent = "-";
          }
          tr.appendChild(sizesCell);

          // Actions cell: Delete button only (as per your code)
          const actionsCell = document.createElement("td");
          actionsCell.classList.add("actions-cell");
          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "Delete";
          deleteBtn.dataset.index = prod.index;
          deleteBtn.addEventListener("click", onDeleteProduct);
          actionsCell.appendChild(deleteBtn);
          tr.appendChild(actionsCell);

          tbody.appendChild(tr);
        });
      }
    }

    // Handle inline contentEditable changes for name and price
    document.querySelector("#productTable tbody").addEventListener("blur", e => {
      if (!e.target.classList.contains("editable")) return;
      const index = parseInt(e.target.dataset.index);
      const field = e.target.dataset.field;
      let value = e.target.textContent.trim();

      if (field === "price") {
        const parsed = parseFloat(value);
        if (isNaN(parsed) || parsed < 0) {
          alert("Please enter a valid price.");
          e.target.textContent = products[index].price.toFixed(2);
          return;
        }
        value = parsed;
      }
      if (field === "name" && !value) {
        alert("Product name cannot be empty.");
        e.target.textContent = products[index].name;
        return;
      }

      products[index][field] = value;
      saveProducts();
    }, true);

    // Handle select change for unisex column
    function onSelectChange(e) {
      const index = parseInt(e.target.dataset.index);
      const value = e.target.value;
      products[index].unisex = value;
      saveProducts();
    }

    // Handle sizes quantity input changes
    function onSizeQtyChange(e) {
      const index = parseInt(e.target.dataset.index);
      const size = e.target.dataset.size;
      let val = parseInt(e.target.value);
      if (isNaN(val) || val < 0) {
        alert("Quantity must be a non-negative integer.");
        e.target.value = products[index].sizes[size];
        return;
      }
      products[index].sizes[size] = val;
      saveProducts();
    }

    // Delete product handler
    function onDeleteProduct(e) {
      const index = parseInt(e.target.dataset.index);
      if (!confirm("Are you sure you want to delete this product?")) return;
      products.splice(index, 1);
      saveProducts();
      renderProductTable();
    }
    
    document.getElementById('addProductForm').addEventListener('submit', function (event) {
  event.preventDefault(); // Prevent form refresh
  const category = document.getElementById('productCategory').value;
  const name = document.getElementById('productName').value;
  const price = parseFloat(document.getElementById('productPrice').value).toFixed(2);

  if (!category || !name || isNaN(price)) {
    alert('Please fill out all required fields.');
    return;
  }

  
    
  </script>

</body>
</html>