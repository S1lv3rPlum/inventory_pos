<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory Manager</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    .header-row {
      background-color: #f0f0f0;
      font-weight: bold;
    }
    .form-section, .table-section {
      display: none;
    }
  </style>
</head>
<body>

<h1>Inventory Manager</h1>

<button onclick="toggleSection('product')">Manage Products</button>
<button onclick="toggleSection('discount')">Manage Discounts</button>

<!-- PRODUCT FORM -->
<div id="productForm" class="form-section">
  <h2>Add Product</h2>
  <form id="addProductForm">
    <label>Product Name: <input type="text" id="productName" required></label><br>
    <label>Category: <input type="text" id="productCategory" required></label><br>
    <label>Cost: <input type="number" step="0.01" id="productCost" required></label><br>
    <label>Sizes (comma-separated): <input type="text" id="productSizes" placeholder="e.g. S,M,L,XL"></label><br>
    <button type="submit">Add Product</button>
  </form>
</div>

<!-- PRODUCT TABLE -->
<div id="productTableSection" class="table-section">
  <h2>Products</h2>
  <table id="productTable"></table>
</div>

<!-- DISCOUNT FORM -->
<div id="discountForm" class="form-section">
  <h2>Add Discount</h2>
  <form id="addDiscountForm">
    <label>Description: <input type="text" id="discountDescription" required></label><br>
    <label>Value: <input type="number" step="0.01" id="discountValue" required></label><br>
    <label>Type:
      <select id="discountType" required>
        <option value="%">%</option>
        <option value="$">$</option>
      </select>
    </label><br>
    <button type="submit">Add Discount</button>
  </form>
</div>

<!-- DISCOUNT TABLE -->
<div id="discountTableSection" class="table-section">
  <h2>Discounts</h2>
  <table id="discountTable">
    <thead>
      <tr><th>Description</th><th>Value</th><th>Type</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  let products = JSON.parse(localStorage.getItem("products") || "[]");
  let discounts = JSON.parse(localStorage.getItem("discounts") || "[]");

  function toggleSection(section) {
    document.querySelectorAll('.form-section, .table-section').forEach(div => div.style.display = 'none');
    if (section === 'product') {
      document.getElementById('productForm').style.display = 'block';
      document.getElementById('productTableSection').style.display = 'block';
    } else {
      document.getElementById('discountForm').style.display = 'block';
      document.getElementById('discountTableSection').style.display = 'block';
    }
  }

  function renderProducts() {
    const table = document.getElementById('productTable');
    table.innerHTML = '';
    const headers = ['Product', 'Cost', 'Action'];
    let sizeSet = new Set();
    products.forEach(p => Object.keys(p.qty || {}).forEach(size => sizeSet.add(size)));
    const sizes = Array.from(sizeSet);
    sizes.forEach(size => headers.splice(-1, 0, size));

    const headerRow = document.createElement('tr');
    headers.forEach(h => {
      const th = document.createElement('th');
      th.textContent = h;
      headerRow.appendChild(th);
    });
    table.appendChild(headerRow);

    const categories = [...new Set(products.map(p => p.category))];
    categories.forEach(cat => {
      const catRow = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = headers.length;
      td.className = 'header-row';
      td.textContent = cat;
      catRow.appendChild(td);
      table.appendChild(catRow);

      products.filter(p => p.category === cat).forEach((p, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input value="${p.name}" onchange="updateProduct(${i}, 'name', this.value)"></td>
          <td><input type="number" step="0.01" value="${p.cost}" onchange="updateProduct(${i}, 'cost', this.value)"></td>
          ${sizes.map(s => `<td><input type="number" value="${p.qty?.[s] || 0}" onchange="updateQty(${i}, '${s}', this.value)"></td>`).join('')}
          <td>
            <button onclick="deleteProduct(${i})">Delete</button>
          </td>
        `;
        table.appendChild(row);
      });
    });
  }

  function renderDiscounts() {
    const tbody = document.querySelector('#discountTable tbody');
    tbody.innerHTML = '';
    discounts.forEach((d, i) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input value="${d.description}" onchange="updateDiscount(${i}, 'description', this.value)"></td>
        <td><input type="number" step="0.01" value="${d.value}" onchange="updateDiscount(${i}, 'value', this.value)"></td>
        <td>
          <select onchange="updateDiscount(${i}, 'type', this.value)">
            <option value="%" ${d.type === '%' ? 'selected' : ''}>%</option>
            <option value="$" ${d.type === '$' ? 'selected' : ''}>$</option>
          </select>
        </td>
        <td><button onclick="deleteDiscount(${i})">Delete</button></td>
      `;
      tbody.appendChild(row);
    });
  }

  function updateProduct(i, field, value) {
    products[i][field] = field === 'cost' ? parseFloat(value) : value;
    saveProducts();
  }

  function updateQty(i, size, value) {
    products[i].qty = products[i].qty || {};
    products[i].qty[size] = parseInt(value) || 0;
    saveProducts();
  }

  function updateDiscount(i, field, value) {
    discounts[i][field] = field === 'value' ? parseFloat(value) : value;
    saveDiscounts();
  }

  function deleteProduct(i) {
    products.splice(i, 1);
    saveProducts();
  }

  function deleteDiscount(i) {
    discounts.splice(i, 1);
    saveDiscounts();
  }

  function saveProducts() {
    localStorage.setItem("products", JSON.stringify(products));
    renderProducts();
  }

  function saveDiscounts() {
    localStorage.setItem("discounts", JSON.stringify(discounts));
    renderDiscounts();
  }

  document.getElementById('addProductForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const name = document.getElementById('productName').value.trim();
    const category = document.getElementById('productCategory').value.trim();
    const cost = parseFloat(document.getElementById('productCost').value);
    const sizes = document.getElementById('productSizes').value.trim().split(',').map(s => s.trim()).filter(Boolean);
    const qty = {};
    sizes.forEach(size => qty[size] = 0);
    products.push({ name, category, cost, qty });
    saveProducts();
    this.reset();
  });

  document.getElementById('addDiscountForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const description = document.getElementById('discountDescription').value.trim();
    const value = parseFloat(document.getElementById('discountValue').value);
    const type = document.getElementById('discountType').value;
    discounts.push({ description, value, type });
    saveDiscounts();
    this.reset();
  });

  // Initialize
  renderProducts();
  renderDiscounts();
  toggleSection('product');
</script>

</body>
</html>