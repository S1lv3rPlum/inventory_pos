<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory and Discount Manager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table, th, td { border: 1px solid black; border-collapse: collapse; }
    th, td { padding: 8px; text-align: left; }
    .hidden { display: none; }
    .btn { margin: 5px; padding: 5px 10px; cursor: pointer; }
    .section { margin-top: 20px; }
    .size-inputs input { width: 50px; margin-right: 5px; }
  </style>
</head>
<body>
  <h1>Inventory and Discount Manager</h1>

  <button id="showInventory" class="btn">Inventory</button>
  <button id="showDiscounts" class="btn">Discounts</button>

  <div id="inventorySection" class="section">
    <h2>Add Product</h2>
    <form id="productForm">
      <input type="text" id="productName" placeholder="Product Name" required />
      <input type="text" id="productCategory" placeholder="Category" required />
      <input type="number" id="productPrice" placeholder="Price" step="0.01" required />
      <input type="number" id="productQuantity" placeholder="Quantity" required />
      <label><input type="checkbox" id="hasSizes" /> Has Sizes</label>
      <button type="submit">Add Product</button>
    </form>

    <h2>Product Inventory</h2>
    <div id="productTableContainer"></div>
  </div>

  <div id="discountSection" class="section hidden">
    <h2>Add Discount</h2>
    <form id="discountForm">
      <input type="text" id="discountName" placeholder="Discount Name" required />
      <select id="discountType">
        <option value="% off">% off</option>
        <option value="$ off">$ off</option>
      </select>
      <input type="number" id="discountAmount" placeholder="Amount" step="0.01" required />
      <button type="submit">Add Discount</button>
    </form>

    <h2>Discounts</h2>
    <table id="discountTable">
      <thead>
        <tr><th>Name</th><th>Type</th><th>Amount</th><th>Action</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let products = JSON.parse(localStorage.getItem("products")) || [];
    let discounts = JSON.parse(localStorage.getItem("discounts")) || [];

    const inventorySection = document.getElementById("inventorySection");
    const discountSection = document.getElementById("discountSection");

    document.getElementById("showInventory").onclick = () => {
      inventorySection.classList.remove("hidden");
      discountSection.classList.add("hidden");
    };

    document.getElementById("showDiscounts").onclick = () => {
      discountSection.classList.remove("hidden");
      inventorySection.classList.add("hidden");
    };

    document.getElementById("productForm").onsubmit = e => {
      e.preventDefault();
      const name = document.getElementById("productName").value;
      const category = document.getElementById("productCategory").value;
      const price = parseFloat(document.getElementById("productPrice").value);
      const quantity = parseInt(document.getElementById("productQuantity").value);
      const hasSizes = document.getElementById("hasSizes").checked;
      
      const newProduct = { name, category, price, quantity, hasSizes, sizes: {} };
      products.push(newProduct);
      localStorage.setItem("products", JSON.stringify(products));
      renderProducts();
      e.target.reset();
    };

    function renderProducts() {
      const container = document.getElementById("productTableContainer");
      container.innerHTML = "";
      const grouped = {};
      for (let product of products) {
        if (!grouped[product.category]) grouped[product.category] = [];
        grouped[product.category].push(product);
      }
      for (let category in grouped) {
        const table = document.createElement("table");
        const thead = table.createTHead();
        thead.innerHTML = `<tr><th colspan="6">${category}</th></tr>
                           <tr><th>Name</th><th>Price</th><th>Qty</th><th>Has Sizes</th><th>Sizes</th><th>Action</th></tr>`;
        const tbody = table.createTBody();
        for (let [index, p] of grouped[category].entries()) {
          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${p.name}</td>
            <td>$${p.price.toFixed(2)}</td>
            <td>${p.hasSizes ? "-" : p.quantity}</td>
            <td>${p.hasSizes ? "Yes" : "No"}</td>
            <td>${p.hasSizes ? Object.entries(p.sizes).map(([s, q]) => `${s}: ${q}`).join(", ") : ""}</td>
            <td><button onclick="editProduct('${p.name}', '${p.category}')">Edit</button></td>
          `;
        }
        container.appendChild(table);
      }
    }

    window.editProduct = function(name, category) {
      const product = products.find(p => p.name === name && p.category === category);
      if (product.hasSizes) {
        const sizeKeys = ["XS", "S", "M", "L", "XL", "2XL", "3XL", "4XL"];
        const inputs = sizeKeys.map(size => {
          const val = product.sizes[size] || 0;
          return `${size}: <input type='number' id='size_${size}' value='${val}' />`;
        }).join("<br>");
        const popup = window.open("", "", "width=400,height=600");
        popup.document.write(`<h3>Edit Sizes for ${product.name}</h3><form id='sizeForm'>${inputs}<br><button type='submit'>Save</button></form>`);
        popup.document.getElementById("sizeForm").onsubmit = e => {
          e.preventDefault();
          for (let size of sizeKeys) {
            const val = parseInt(popup.document.getElementById(`size_${size}`).value) || 0;
            product.sizes[size] = val;
          }
          localStorage.setItem("products", JSON.stringify(products));
          renderProducts();
          popup.close();
        };
      } else {
        const newQty = prompt("Enter new quantity:", product.quantity);
        if (newQty !== null) {
          product.quantity = parseInt(newQty);
          localStorage.setItem("products", JSON.stringify(products));
          renderProducts();
        }
      }
    };

    document.getElementById("discountForm").onsubmit = e => {
      e.preventDefault();
      const name = document.getElementById("discountName").value;
      const type = document.getElementById("discountType").value;
      const amount = parseFloat(document.getElementById("discountAmount").value);
      discounts.push({ name, type, amount });
      localStorage.setItem("discounts", JSON.stringify(discounts));
      renderDiscounts();
      e.target.reset();
    };

    function renderDiscounts() {
      const tbody = document.querySelector("#discountTable tbody");
      tbody.innerHTML = "";
      discounts.forEach((d, i) => {
        const row = tbody.insertRow();
        row.innerHTML = `<td>${d.name}</td><td>${d.type}</td><td>${d.amount}</td><td><button onclick="editDiscount(${i})">Edit</button></td>`;
      });
    }

    window.editDiscount = function(index) {
      const d = discounts[index];
      const name = prompt("Edit name:", d.name);
      const type = prompt("Edit type (% off or $ off):", d.type);
      const amount = prompt("Edit amount:", d.amount);
      if (name && type && !isNaN(parseFloat(amount))) {
        discounts[index] = { name, type, amount: parseFloat(amount) };
        localStorage.setItem("discounts", JSON.stringify(discounts));
        renderDiscounts();
      }
    };

    renderProducts();
    renderDiscounts();
  </script>
</body>
</html>
